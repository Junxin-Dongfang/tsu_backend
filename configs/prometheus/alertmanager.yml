# Alertmanager é…ç½®
# ç”¨äºå¤„ç† Prometheus å‘Šè­¦å¹¶å‘é€é€šçŸ¥

global:
  resolve_timeout: 5m
  # Slack webhook(å¦‚éœ€é…ç½®)
  # slack_api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'

# å‘Šè­¦è·¯ç”±è§„åˆ™
route:
  # æ ¹è·¯ç”± - æ‰€æœ‰å‘Šè­¦çš„é»˜è®¤å¤„ç†
  receiver: 'default'
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s        # ç­‰å¾…èšåˆçš„æ—¶é—´
  group_interval: 10s    # èšåˆåå†æ¬¡å‘é€çš„é—´éš”
  repeat_interval: 12h   # é‡å¤å‘é€å‘Šè­¦çš„é—´éš”

  # å­è·¯ç”± - æ ¹æ®æ ‡ç­¾è·¯ç”±åˆ°ä¸åŒçš„æ¥æ”¶å™¨
  routes:
    # ä¸¥é‡å‘Šè­¦ç«‹å³å‘é€
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 0s
      repeat_interval: 5m

    # æ•°æ®åº“ç›¸å…³å‘Šè­¦
    - match_re:
        alertname: '.*Database.*'
      receiver: 'database-alerts'

    # ä¸šåŠ¡å‘Šè­¦
    - match_re:
        alertname: '.*(Player|Battle|Quest).*'
      receiver: 'business-alerts'

# æ¥æ”¶å™¨é…ç½®
receivers:
  # é»˜è®¤æ¥æ”¶å™¨ - ä»…è®°å½•æ—¥å¿—
  - name: 'default'
    # webhook_configs:
    #   - url: 'http://localhost:5001/webhook'

  # ä¸¥é‡å‘Šè­¦æ¥æ”¶å™¨
  - name: 'critical-alerts'
    # Slack é€šçŸ¥(ç¤ºä¾‹)
    # slack_configs:
    #   - channel: '#alerts-critical'
    #     title: 'ğŸš¨ Critical Alert: {{ .GroupLabels.alertname }}'
    #     text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'

    # Email é€šçŸ¥(ç¤ºä¾‹)
    # email_configs:
    #   - to: 'oncall@example.com'
    #     from: 'alertmanager@example.com'
    #     smarthost: 'smtp.example.com:587'
    #     auth_username: 'alertmanager@example.com'
    #     auth_password: 'password'

  # æ•°æ®åº“å‘Šè­¦æ¥æ”¶å™¨
  - name: 'database-alerts'
    # webhook_configs:
    #   - url: 'http://localhost:5001/webhook/database'

  # ä¸šåŠ¡å‘Šè­¦æ¥æ”¶å™¨
  - name: 'business-alerts'
    # webhook_configs:
    #   - url: 'http://localhost:5001/webhook/business'

# å‘Šè­¦æŠ‘åˆ¶è§„åˆ™(é¿å…é‡å¤å‘Šè­¦)
inhibit_rules:
  # å¦‚æœæœåŠ¡ä¸å¯ç”¨,æŠ‘åˆ¶è¯¥æœåŠ¡çš„å…¶ä»–å‘Šè­¦
  - source_match:
      severity: 'critical'
      alertname: 'ServiceDown'
    target_match_re:
      severity: 'warning|info'
    equal: ['service', 'instance']

  # å¦‚æœæœ‰é«˜é”™è¯¯ç‡å‘Šè­¦,æŠ‘åˆ¶é«˜å»¶è¿Ÿå‘Šè­¦(å¯èƒ½æ˜¯åŒä¸€ä¸ªé—®é¢˜)
  - source_match:
      alertname: 'HighErrorRate'
    target_match:
      alertname: 'HighLatency'
    equal: ['service']
