# 游戏配置表结构说明 v2.0

## 📋 目录
1. [基础配置表](#基础配置表)
2. [核心系统表](#核心系统表)
3. [关联配置表](#关联配置表)
4. [元数据表](#元数据表)
5. [配置示例](#配置示例)

---

## 基础配置表

### 1. 角色数据类型 (hero_attribute_types)
**说明**: 定义所有角色属性类型
**必填字段**: 代码、名称、分类、数据类型

| 列名 | 数据类型 | 必填 | 说明 | 示例 |
|------|---------|------|------|------|
| 代码 | 文本(32) | ✓ | 唯一标识，大写+下划线 | STR, AGI, FIRE_RESIST |
| 名称 | 文本(64) | ✓ | 显示名称 | 力量, 敏捷, 火焰抗性 |
| 分类 | 下拉 | ✓ | basic/derived/resistance | basic |
| 数据类型 | 下拉 | ✓ | integer/decimal/percentage/boolean | integer |
| 最小值 | 数字 | - | 属性最小值 | 1 |
| 最大值 | 数字 | - | 属性最大值 | 100 |
| 默认值 | 数字 | - | 默认值 | 10 |
| 单位 | 文本(16) | - | 显示单位 | 点, % |
| 描述 | 文本 | - | 详细说明 | 影响物理攻击力和负重 |
| 是否启用 | 布尔 | ✓ | TRUE/FALSE | TRUE |

**数据验证规则**:
- 代码: 唯一，不可重复
- 分类: 下拉列表 {basic, derived, resistance}
- 数据类型: 下拉列表 {integer, decimal, percentage, boolean}

---

### 2. 伤害类型 (damage_types)
**说明**: 定义所有伤害类型及其抗性关系

| 列名 | 数据类型 | 必填 | 说明 | 示例 |
|------|---------|------|------|------|
| 代码 | 文本(50) | ✓ | 唯一标识 | PHYSICAL, FIRE, ICE |
| 名称 | 文本(100) | ✓ | 显示名称 | 物理伤害, 火焰伤害 |
| 分类 | 下拉 | ✓ | physical/magical/elemental/special | physical |
| 抗性属性 | 文本(50) | - | 对应的抗性属性代码 | PHYSICAL_RESIST |
| 伤害减免属性 | 文本(50) | - | 固定值减免属性代码 | FIRE_DmgReduce |
| 抗性上限 | 数字(0-100) | ✓ | 抗性百分比上限 | 75 |
| 颜色 | 文本(16) | - | 十六进制颜色 | #FF4500 |
| 图标 | 文本(256) | - | 图标路径 | /icons/fire.png |
| 描述 | 文本 | - | 详细说明 | 火焰魔法造成的伤害 |
| 是否启用 | 布尔 | ✓ | TRUE/FALSE | TRUE |

**特殊说明**:
- 抗性上限为0表示无法抗性（如真实伤害）
- 抗性属性必须在"角色数据类型"表中存在

---

### 3. 技能类别 (skill_categories)
**说明**: 技能的大类划分

| 列名 | 数据类型 | 必填 | 说明 | 示例 |
|------|---------|------|------|------|
| 代码 | 文本(32) | ✓ | 唯一标识 | COMBAT, SUPPORT |
| 名称 | 文本(64) | ✓ | 显示名称 | 战斗技能, 辅助技能 |
| 描述 | 文本 | - | 详细说明 | 用于战斗的主动和被动技能 |
| 图标 | 文本(256) | - | 图标路径 | /icons/combat.png |
| 颜色 | 文本(16) | - | 代表色 | #E74C3C |
| 显示顺序 | 数字 | ✓ | 排序权重 | 1 |
| 是否启用 | 布尔 | ✓ | TRUE/FALSE | TRUE |

---

### 4. 动作类别 (action_categories)
**说明**: 动作的分类

| 列名 | 数据类型 | 必填 | 说明 | 示例 |
|------|---------|------|------|------|
| 代码 | 文本(32) | ✓ | 唯一标识 | BASIC_ATTACK, SUMMON |
| 名称 | 文本(64) | ✓ | 显示名称 | 基础攻击, 召唤 |
| 描述 | 文本 | - | 详细说明 | 基础的物理和魔法攻击动作 |
| 是否启用 | 布尔 | ✓ | TRUE/FALSE | TRUE |

---

## 核心系统表

### 5. 元效果类型定义 (effect_type_definitions)
**说明**: 定义所有可用的元效果类型（游戏逻辑的原子操作）

| 列名 | 数据类型 | 必填 | 说明 | 示例 |
|------|---------|------|------|------|
| 元效果代码 | 文本(50) | ✓ | 唯一标识 | HIT_CHECK, DMG_CALCULATION |
| 名称 | 文本(100) | ✓ | 显示名称 | 命中检定, 伤害计算 |
| 描述 | 文本 | ✓ | 详细说明 | 进行攻击命中判定 |
| 参数列表 | 文本(多个，逗号分隔) | ✓ | 参数名称 | MATCH_TARGET,MATCH_FLAG,Base_DMG |
| 参数说明 | 文本 | ✓ | 每个参数的含义 | MATCH_TARGET:匹配目标;... |
| 失败处理 | 下拉 | ✓ | skip_remaining/continue | skip_remaining |
| JSON模板 | JSON文本 | ✓ | 配置模板 | {"effect":"HIT_CHECK",...} |
| 示例 | 文本 | - | 使用示例 | 基础攻击命中判定 |
| 是否启用 | 布尔 | ✓ | TRUE/FALSE | TRUE |

**数据验证**:
- 失败处理: 下拉 {skip_remaining, continue}
- JSON模板: 必须是合法的JSON格式

---

### 6. 技能配置 (skills)
**说明**: 定义所有技能

| 列名 | 数据类型 | 必填 | 说明 | 示例 |
|------|---------|------|------|------|
| 代码 | 文本(50) | ✓ | 唯一标识 | SWORD_PROFICIENCY |
| 名称 | 文本(100) | ✓ | 显示名称 | 剑类熟练 |
| 技能类型 | 下拉 | ✓ | weapon/magic/physical/usage/reaction/guard | weapon |
| 技能类别 | 文本(32) | - | 关联skill_categories的代码 | COMBAT |
| 最大等级 | 数字(1-100) | ✓ | 技能最高等级 | 40 |
| 特征标签 | 文本(多个，逗号分隔) | - | 特征标签列表 | weapon,melee,sword,proficiency |
| 被动效果 | JSON文本 | - | 被动效果配置 | {"type":"stat_bonus",...} |
| 解锁动作配置 | JSON数组 | - | 解锁的动作列表 | [{"action":"weapon_attack","unlock_level":1}] |
| 需求等级 | 数字 | ✓ | 学习所需等级 | 1 |
| 需求职业 | 文本(多个，逗号分隔) | - | 可学习的职业代码 | WARRIOR,FIGHTER |
| 前置技能 | 文本(多个，逗号分隔) | - | 前置技能代码 | BASIC_COMBAT |
| 描述 | 文本 | - | 简短说明 | 熟练掌握各种剑类武器 |
| 详细描述 | 文本 | - | 详细说明 | |
| 图标 | 文本(256) | - | 图标路径 | /icons/sword_skill.png |
| 是否启用 | 布尔 | ✓ | TRUE/FALSE | TRUE |

**重要说明**:
- 解锁动作配置格式: `[{"action":"动作代码","unlock_level":解锁等级,"is_default":true/false}]`
- 特征标签用于筛选和匹配，建议统一命名规范

---

### 7. 技能等级配置 (skill_level_configs)
**说明**: 每个技能每个等级的具体数值

| 列名 | 数据类型 | 必填 | 说明 | 示例 |
|------|---------|------|------|------|
| 技能代码 | 文本(50) | ✓ | 关联skills表 | SWORD_PROFICIENCY |
| 等级 | 数字 | ✓ | 技能等级(1-100) | 1 |
| 伤害倍数 | 小数(2位) | - | 对伤害的加成倍数 | 1.0 |
| 治疗倍数 | 小数(2位) | - | 对治疗的加成倍数 | 1.0 |
| 持续时间修正 | 整数 | - | 持续时间修正值 | 0 |
| 射程修正 | 整数 | - | 射程修正值 | 0 |
| 冷却修正 | 整数 | - | 冷却时间修正值 | 0 |
| MP消耗修正 | 整数 | - | MP消耗修正值 | 0 |
| 其他效果修正 | JSON文本 | - | 自定义修正 | {"crit_rate":"+5%"} |
| 升级经验消耗 | 整数 | ✓ | 升级所需经验 | 100 |
| 升级金币消耗 | 整数 | ✓ | 升级所需金币 | 50 |
| 升级材料 | JSON文本 | - | 所需材料 | {"item_id":"MAT001","count":2} |

**配置建议**:
- 可以只配置有变化的等级，其他等级继承前一级
- 倍数默认1.0表示无加成

---

### 8. 动作配置 (actions)
**说明**: 定义所有可执行的动作（核心配置表）

| 列名 | 数据类型 | 必填 | 说明 | 示例 |
|------|---------|------|------|------|
| 动作代码 | 文本(50) | ✓ | 唯一标识 | weapon_attack_sword |
| 动作名称 | 文本(100) | ✓ | 显示名称 | 剑类武器攻击 |
| 动作类别 | 文本(32) | ✓ | 关联action_categories | BASIC_ATTACK |
| 动作类型 | 下拉 | ✓ | main/minor/reaction | main |
| 特征标签 | 文本(逗号分隔) | - | 特征标签 | attack,melee,sword |
| 关联技能 | 文本(50) | - | 关联的技能代码 | SWORD_PROFICIENCY |
| 射程配置 | 文本 | ✓ | 格式见说明 | range:0;positions:最近1位;depth:单体 |
| 目标配置 | JSON文本 | - | 目标选择配置 | {"type":"single","ally":false} |
| 范围配置 | JSON文本 | - | 作用范围配置 | {"type":"single"} |
| 动作点消耗 | 数字 | ✓ | 消耗的动作点 | 1 |
| MP消耗 | 数字 | - | 固定MP消耗 | 0 |
| MP消耗公式 | 文本 | - | 动态MP消耗公式 | 50+2*skill_level |
| 冷却回合 | 数字 | ✓ | 冷却时间(回合) | 0 |
| 每战使用次数 | 数字 | - | 每场战斗限制 | |
| 命中率配置 | JSON文本 | - | 命中率计算 | 见下方说明 |
| 效果配置 | JSON文本 | ✓ | 完整效果配置 | 见下方说明 |
| 开始标记 | 文本(逗号分隔) | - | 动作开始时的Flag | STARTING_ATTACK_ACTION |
| 需求条件 | JSON文本 | - | 使用条件 | {"has_weapon":true} |
| 描述 | 文本 | ✓ | 简短说明 | 使用剑类武器进行近战攻击 |
| 是否启用 | 布尔 | ✓ | TRUE/FALSE | TRUE |

**射程配置格式**:
```
range:N;positions:最近/最远X位;depth:单体/全体
示例: range:6;positions:最近1位;depth:单体
```

**命中率配置格式** (可选，有默认值):
```json
{
  "base_hit_rate": 75,
  "use_attacker_accuracy": true,
  "accuracy_attribute": "ACCURACY",
  "accuracy_multiplier": 1.0,
  "min_hit_rate": 5,
  "max_hit_rate": 95
}
```

**效果配置格式** (重要):
```json
{
  "Basic_consume": {
    "action": "main",
    "action_number": "1",
    "mp_cost": "0"
  },
  "Effects": [
    {
      "effect": "HIT_CHECK",
      "params": {
        "MATCH_TARGET": "0",
        "MATCH_FLAG": "0",
        "Key_Attribute_1": "STR",
        "Key_Attribute_2": "AGI",
        "AccSkill_Type": "SWORD_PROFICIENCY"
      },
      "order": 0
    },
    {
      "effect": "DMG_CALCULATION",
      "params": {...},
      "order": 1
    }
  ]
}
```

---

### 9. Buff配置 (buffs)
**说明**: 定义所有Buff/Debuff

| 列名 | 数据类型 | 必填 | 说明 | 示例 |
|------|---------|------|------|------|
| 代码 | 文本(50) | ✓ | 唯一标识 | BLEED, BURN |
| 名称 | 文本(100) | ✓ | 显示名称 | 流血, 灼烧 |
| Buff类型 | 下拉 | ✓ | buff/debuff/neutral | debuff |
| 分类 | 文本(50) | - | magic/body/environment | body |
| 特征标签 | 文本(逗号分隔) | - | 特征标签 | negative,bleed,continuous_damage |
| 默认持续时间 | 数字 | ✓ | 默认回合数 | 3 |
| 最小持续时间 | 数字 | - | 最小回合数 | 1 |
| 最大持续时间 | 数字 | - | 最大回合数 | 10 |
| 效果描述 | 文本 | ✓ | 面向玩家的描述 | HP每回合减少N%*角色等级 |
| 叠加规则 | 下拉 | ✓ | no_stack/stackable/replace/refresh | stackable |
| 最大叠加层数 | 数字 | - | 可叠加时的上限 | 5 |
| 参数列表 | 文本(逗号分隔) | - | 参数名称 | N |
| 参数定义 | JSON文本 | - | 参数详细定义 | {"N":{"type":"percentage","min":0,"max":100}} |
| 触发事件 | 文本(逗号分隔) | - | 触发时机 | turn_start,turn_end |
| 提供优势 | 布尔 | - | 是否提供优势 | FALSE |
| 提供劣势 | 布尔 | - | 是否提供劣势 | FALSE |
| 优劣势作用范围 | 文本(逗号分隔) | - | 作用的判定类型 | hit_rate,critical_rate |
| 图标 | 文本(256) | - | 图标路径 | /icons/bleed.png |
| 颜色 | 文本(16) | - | 代表色 | #8B0000 |
| 描述 | 文本 | - | 设计说明 | 使角色持续受到流血伤害 |
| 是否启用 | 布尔 | ✓ | TRUE/FALSE | TRUE |

---

### 10. 动作标记 (action_flags)
**说明**: 定义动作执行过程中的标记/状态

| 列名 | 数据类型 | 必填 | 说明 | 示例 |
|------|---------|------|------|------|
| 代码 | 文本(50) | ✓ | 唯一标识 | HIT_SUCCESS |
| 名称 | 文本(100) | ✓ | 显示名称 | 命中检定成功 |
| 分类 | 下拉 | - | action_chain/check_status/modifier | check_status |
| 持续类型 | 下拉 | ✓ | action/turn/battle/permanent | action |
| 默认持续时间 | 文本 | ✓ | 持续时间或"-" | - |
| 自动移除条件 | 下拉 | - | 移除时机 | next_act_start |
| 移除事件 | 文本(逗号分隔) | - | 触发移除的事件 | |
| 是否可见 | 布尔 | ✓ | 在UI中显示 | FALSE |
| 是否可叠加 | 布尔 | - | 是否可叠加 | FALSE |
| 最大叠加数 | 数字 | - | 叠加上限 | 1 |
| 提供优势 | 布尔 | - | 是否提供优势 | FALSE |
| 提供劣势 | 布尔 | - | 是否提供劣势 | FALSE |
| 优劣势作用范围 | 文本(逗号分隔) | - | 作用判定类型 | hit_rate |
| Flag效果 | JSON文本 | - | Flag产生的效果 | |
| 修饰符效果 | JSON文本 | - | 修饰符配置 | |
| 描述 | 文本 | ✓ | 详细说明 | 标记本动作成功命中 |
| 是否启用 | 布尔 | ✓ | TRUE/FALSE | TRUE |

**自动移除条件**:
- act_end: 动作结束时
- next_act_start: 下个动作开始时
- this_act_end: 本动作结束时
- turn_start: 回合开始时
- turn_end: 回合结束时

---

## 元数据表

### 11. 公式变量定义 (formula_variables)
**说明**: 定义所有可在配置公式中使用的变量（文档用途）

| 列名 | 数据类型 | 必填 | 说明 | 示例 |
|------|---------|------|------|------|
| 变量代码 | 文本(50) | ✓ | 唯一标识 | STR, skill_level |
| 变量名称 | 文本(100) | ✓ | 显示名称 | 力量, 技能等级 |
| 变量类型 | 下拉 | ✓ | 类型分类 | attribute, skill_data |
| 作用域 | 下拉 | ✓ | character/action/skill/equipment | character |
| 数据类型 | 下拉 | ✓ | integer/decimal/string/object | integer |
| 说明 | 文本 | ✓ | 详细说明 | 角色的力量属性值 |
| 示例 | 文本 | ✓ | 使用示例 | STR*2+10 |
| 是否启用 | 布尔 | ✓ | TRUE/FALSE | TRUE |

**变量类型**:
- attribute: 基础属性
- target: 目标选择
- skill_data: 技能数据
- equipment_data: 装备数据
- global: 全局变量

---

### 12. 射程配置规则 (range_config_rules)
**说明**: 射程参数格式说明（文档/验证用途）

| 列名 | 数据类型 | 必填 | 说明 | 示例 |
|------|---------|------|------|------|
| 参数类型 | 文本(50) | ✓ | range/positions/depth | range |
| 参数格式 | 文本(100) | ✓ | 格式说明 | N, 0~N, 最近N位 |
| 说明 | 文本 | ✓ | 详细解释 | 固定射程N格 |
| 示例 | 文本(200) | ✓ | 配置示例 | range:6 |
| 备注 | 文本 | - | 补充说明 | 表示射程为6格 |

---

### 13. 动作类型定义 (action_type_definitions)
**说明**: 动作类型的规则说明（文档用途）

| 列名 | 数据类型 | 必填 | 说明 | 示例 |
|------|---------|------|------|------|
| 动作类型 | 文本(20) | ✓ | main/minor/reaction | main |
| 说明 | 文本 | ✓ | 详细解释 | 主要动作，每回合1次 |
| 每回合限制 | 数字 | - | 次数限制 | 1 |
| 使用时机 | 文本 | ✓ | 何时可用 | 回合中 |
| 示例 | 文本 | ✓ | 典型动作 | 普通攻击、施放法术 |

---

### 14. 特征配置 (feature_tags)
**说明**: 统一管理所有特征标签

| 列名 | 数据类型 | 必填 | 说明 | 示例 |
|------|---------|------|------|------|
| 特征代码 | 文本(50) | ✓ | 唯一标识 | attack, magic, fire |
| 特征名称 | 文本(100) | ✓ | 显示名称 | 攻击, 魔法, 火焰 |
| 适用类型 | 文本(逗号分隔) | ✓ | 可用于哪些配置 | skill,action,buff |
| 颜色 | 文本(16) | - | 代表色 | #FF0000 |
| 图标 | 文本(256) | - | 图标路径 | /icons/fire.png |
| 描述 | 文本 | - | 详细说明 | 火焰系特征 |
| 是否启用 | 布尔 | ✓ | TRUE/FALSE | TRUE |

---

## 配置示例

### 示例1: 完整的攻击动作配置

**技能配置** (Sheet: 技能配置)
```
代码: SWORD_PROFICIENCY
名称: 剑类熟练
技能类型: weapon
最大等级: 40
特征标签: weapon,melee,sword,proficiency
解锁动作配置: [{"action":"weapon_attack_sword","unlock_level":1}]
```

**动作配置** (Sheet: 动作配置)
```
动作代码: weapon_attack_sword
动作名称: 剑类武器攻击
动作类别: BASIC_ATTACK
动作类型: main
特征标签: attack,melee,sword
关联技能: SWORD_PROFICIENCY
射程配置: range:0;positions:最近1位;depth:单体
MP消耗: 0
效果配置:
{
  "Basic_consume": {
    "action": "main",
    "action_number": "1",
    "mp_cost": "0"
  },
  "Effects": [
    {
      "effect": "HIT_CHECK",
      "params": {
        "MATCH_TARGET": "0",
        "MATCH_FLAG": "0",
        "Key_Attribute_1": "STR",
        "Key_Attribute_2": "AGI",
        "AccSkill_Type": "SWORD_PROFICIENCY"
      },
      "order": 0
    },
    {
      "effect": "CRIT_CHECK",
      "params": {
        "MATCH_TARGET": "Target",
        "MATCH_FLAG": "Hit_SUCCESS",
        "Act_Crit_%": "2",
        "Crit_Multiplier": "0"
      },
      "order": 1
    },
    {
      "effect": "DMG_CALCULATION",
      "params": {
        "MATCH_TARGET": "Target",
        "MATCH_FLAG": "Hit_SUCCESS",
        "Base_DMG": "Weapon_DMG",
        "Base_DMG_type": "PHYSICAL",
        "DMG_Attribute_1": "STR",
        "DMG_Attribute_2": "AGI",
        "Action_Mult": "1",
        "Current_Crit_Mult": "get_Crit_Multiplier"
      },
      "order": 2
    }
  ]
}
开始标记: STARTING_ATTACK_ACTION,STARTING_MAIN_ACTION
```

---

### 示例2: 带参数的Buff配置

**Buff配置** (Sheet: Buff配置)
```
代码: BLEED
名称: 流血
Buff类型: debuff
分类: body
特征标签: negative,bleed,continuous_damage
默认持续时间: 3
效果描述: HP每回合减少N%*角色等级，无伤害类型
叠加规则: stackable
最大叠加层数: 5
参数列表: N
参数定义:
{
  "N": {
    "type": "percentage",
    "description": "伤害百分比",
    "min": 0,
    "max": 100,
    "default": 5
  }
}
触发事件: turn_start
```

---

## 配置工具建议

### Excel数据验证设置

1. **下拉列表**:
   - 为所有枚举字段创建下拉列表
   - 数据源可以放在单独的"数据字典"Sheet

2. **条件格式**:
   - 必填字段为空时标红
   - 代码重复时标黄
   - 引用不存在时标橙

3. **公式验证**:
   - 代码唯一性检查: `=COUNTIF(A:A,A2)=1`
   - 外键引用检查: `=COUNTIF(技能配置!A:A,关联技能)>0`

4. **输入提示**:
   - 为每个字段添加批注说明
   - 在第一行添加详细的字段说明

---

## 数据导入流程

### 阶段1: 基础配置导入
按以下顺序导入，保证依赖关系：

1. 角色数据类型
2. 伤害类型
3. 技能类别
4. 动作类别
5. 特征配置
6. 元效果类型定义
7. 公式变量定义
8. 射程配置规则
9. 动作类型定义

### 阶段2: 核心配置导入

10. 动作标记 (action_flags)
11. Buff配置
12. 技能配置
13. 技能等级配置
14. 动作配置

### 阶段3: 验证检查

- 所有外键引用存在性检查
- JSON格式验证
- 必填字段完整性检查
- 循环依赖检查

---

## 新增辅助Sheet

### Sheet15: 数据字典
**说明**: 存储所有下拉列表的数据源

| 配置项 | 可选值 |
|--------|--------|
| 属性分类 | basic, derived, resistance |
| 数据类型 | integer, decimal, percentage, boolean |
| 伤害分类 | physical, magical, elemental, special |
| 技能类型 | weapon, magic, physical, usage, reaction, guard |
| Buff类型 | buff, debuff, neutral |
| 动作类型 | main, minor, reaction |
| 叠加规则 | no_stack, stackable, replace, refresh |
| 持续类型 | action, turn, battle, permanent |
| 失败处理 | skip_remaining, continue |
| 变量类型 | attribute, target, skill_data, equipment_data, global |
| 作用域 | character, action, skill, equipment, global |
| 自动移除条件 | act_end, next_act_start, this_act_end, turn_start, turn_end |

---

### Sheet16: 配置验证
**说明**: 用于检查配置完整性和一致性

#### A. 外键引用检查
```excel
技能配置.技能类别 → 技能类别.代码
技能配置.需求职业 → 职业表.代码
动作配置.动作类别 → 动作类别.代码
动作配置.关联技能 → 技能配置.代码
Buff配置.抗性属性 → 角色数据类型.代码
```

#### B. JSON格式验证
列出所有JSON字段及其格式要求

#### C. 数据统计
```
总技能数: 
总动作数:
总Buff数:
总元效果类型数:
待启用配置数:
配置错误数:
```

---

### Sheet17: 快速配置模板

#### 基础攻击动作模板
```
动作代码: [填写]_attack
动作名称: [填写]攻击
动作类别: BASIC_ATTACK
动作类型: main
特征标签: attack,melee
射程配置: range:0;positions:最近1位;depth:单体
MP消耗: 0
效果配置: 
{
  "Basic_consume": {"action": "main", "action_number": "1", "mp_cost": "0"},
  "Effects": [
    {"effect": "HIT_CHECK", "params": {"MATCH_TARGET": "0", "MATCH_FLAG": "0", "Key_Attribute_1": "STR", "Key_Attribute_2": "AGI", "AccSkill_Type": "[技能代码]"}, "order": 0},
    {"effect": "CRIT_CHECK", "params": {"MATCH_TARGET": "Target", "MATCH_FLAG": "Hit_SUCCESS", "Act_Crit_%": "5", "Crit_Multiplier": "0"}, "order": 1},
    {"effect": "DMG_CALCULATION", "params": {"MATCH_TARGET": "Target", "MATCH_FLAG": "Hit_SUCCESS", "Base_DMG": "Weapon_DMG", "Base_DMG_type": "PHYSICAL", "DMG_Attribute_1": "STR", "DMG_Attribute_2": "AGI", "Action_Mult": "1", "Current_Crit_Mult": "get_Crit_Multiplier"}, "order": 2}
  ]
}
开始标记: STARTING_ATTACK_ACTION,STARTING_MAIN_ACTION
```

#### 魔法攻击动作模板
```
动作代码: [填写]_magic
动作名称: [填写]术
动作类别: BASIC_SAVE
动作类型: main
特征标签: attack,magic,flaw
射程配置: range:10;positions:最近1位;depth:单体
MP消耗公式: 30+2*skill_level
效果配置:
{
  "Basic_consume": {"action": "main", "action_number": "1", "mp_cost": "30+2*skill_level"},
  "Effects": [
    {"effect": "SAVE_CHECK", "params": {"MATCH_TARGET": "0", "MATCH_FLAG": "0", "save_type": "magic"}, "order": 0},
    {"effect": "DMG_CALCULATION", "params": {"MATCH_TARGET": "Target", "MATCH_FLAG": "SAVE_CHECK_FAIL", "Base_DMG": "10+skill_level", "Base_DMG_type": "FIRE", "DMG_Attribute_1": "INT", "DMG_Attribute_2": "WIP", "Action_Mult": "1", "Current_Crit_Mult": "0"}, "order": 1}
  ]
}
开始标记: STARTING_MAGIC_ACTION,STARTING_FLAW_ACTION,STARTING_MAIN_ACTION
```

#### DOT Buff模板
```
代码: [填写]_DOT
名称: [填写]效果
Buff类型: debuff
分类: body
特征标签: negative,continuous_damage,[伤害类型]
默认持续时间: 3
效果描述: HP每回合减少N%*角色等级，[伤害类型]
叠加规则: stackable
最大叠加层数: 5
参数列表: N
参数定义: {"N":{"type":"percentage","description":"伤害百分比","min":0,"max":100,"default":5}}
触发事件: turn_start
```

---

### Sheet18: 常用公式示例

#### MP消耗公式
```
固定值: 50
等级缩放: 10+2*skill_level
属性缩放: 30+INT*0.5
复合: 20+skill_level*3+INT*0.2
```

#### 伤害计算公式
```
基础武器伤害: Weapon_DMG
武器+属性: Weapon_DMG+STR
纯属性: STR*2+AGI
魔法伤害: 10+skill_level*2+INT*1.5
百分比生命: Target_MaxHP*0.1
```

#### 持续时间公式
```
固定回合: 3
等级缩放: 2+skill_level/10
属性影响: 3+INT/20
```

---

## Excel表格优化建议

### 1. 使用命名范围
为常用的引用创建命名范围，便于公式编写：
```
技能代码列 → SkillCodes
动作代码列 → ActionCodes
属性代码列 → AttributeCodes
```

### 2. 冻结首行和首列
- 冻结标题行，方便查看字段名
- 冻结代码列，方便定位配置

### 3. 分组显示
将相关字段分组折叠：
- 基础信息组
- 数值配置组
- 效果配置组
- 显示配置组
- 系统字段组

### 4. 条件格式化
```
- 必填字段未填写 → 红色背景
- 代码重复 → 黄色背景
- 引用不存在 → 橙色背景
- 已禁用配置 → 灰色文字
- JSON格式错误 → 粉色背景
```

### 5. 筛选和排序
- 为所有表启用自动筛选
- 添加辅助列用于排序（如是否启用、配置完成度）

---

## 配置完整性检查清单

### 基础检查
- [ ] 所有必填字段已填写
- [ ] 代码字段无重复
- [ ] 所有外键引用存在
- [ ] 枚举值在允许范围内
- [ ] 数值字段在有效范围内

### 格式检查
- [ ] JSON字段格式正确
- [ ] 逗号分隔字段格式正确
- [ ] 颜色值格式正确(#RRGGBB)
- [ ] 路径格式正确

### 逻辑检查
- [ ] 技能解锁的动作存在
- [ ] 动作引用的技能存在
- [ ] Buff引用的抗性属性存在
- [ ] 效果配置中的元效果类型存在
- [ ] 公式中使用的变量都已定义

### 完整性检查
- [ ] 每个技能至少解锁一个动作
- [ ] 每个动作至少有一个效果
- [ ] 所有元效果类型都有JSON模板
- [ ] 所有特征标签都已定义

---

## 导入工具功能需求

### 基础功能
1. **Excel读取**: 读取所有Sheet的数据
2. **数据验证**: 执行完整性检查
3. **错误报告**: 生成详细的错误报告
4. **数据转换**: 将Excel数据转换为数据库格式
5. **批量导入**: 按依赖顺序批量插入数据

### 高级功能
6. **增量更新**: 只导入变更的配置
7. **版本对比**: 对比两个配置版本的差异
8. **配置回滚**: 支持回滚到历史版本
9. **导出功能**: 从数据库导出为Excel格式
10. **配置生成器**: 根据模板批量生成配置

### 辅助功能
11. **公式解析**: 验证公式语法
12. **JSON格式化**: 自动格式化JSON字段
13. **引用检查**: 检查所有外键引用
14. **重复检测**: 检测重复配置
15. **配置预览**: 导入前预览效果

---

## 最佳实践建议

### 配置命名规范
```
技能代码: [类型]_[名称]
  示例: SWORD_PROFICIENCY, FIRE_BALL_MAGIC

动作代码: [动词]_[对象]_[类型]
  示例: weapon_attack_sword, fire_ball, summon_zombie

Buff代码: [效果名]_[后缀]
  示例: BLEED, BURN, ICED_LAND

Flag代码: [状态]_[描述]
  示例: HIT_SUCCESS, STARTING_ATTACK_ACTION
```

### 特征标签规范
```
分类标签:
- 武器类型: sword, bow, staff, dagger
- 攻击类型: melee, ranged, magic
- 伤害类型: physical, fire, ice, lightning
- 目标类型: single, aoe, self, ally
- 动作特性: attack, defense, movement, summon
- 状态特性: positive, negative, neutral
- 持续性: instant, continuous, toggle
```

### JSON配置规范
- 使用双引号，不用单引号
- 数值类型不加引号
- 布尔值用 true/false，不用字符串
- 保持适当的缩进和换行
- 复杂配置可以用工具验证

### 公式编写规范
- 使用明确的变量名
- 避免过于复杂的嵌套
- 添加注释说明计算逻辑
- 测试边界情况
- 考虑性能影响

---

## 版本控制建议

### 配置版本号规则
格式: `主版本.次版本.修订版.构建号`
示例: `2.1.3.20241201`

- 主版本: 重大架构变更
- 次版本: 新增功能模块
- 修订版: bug修复和微调
- 构建号: 日期或序号

### 变更日志
在单独的Sheet记录每次配置变更：
- 版本号
- 变更日期
- 变更类型 (新增/修改/删除)
- 影响的配置项
- 变更原因
- 变更人

### 配置审核流程
1. 策划填写配置
2. 自动验证检查
3. 程序审核确认
4. 测试环境验证
5. 正式环境部署

---

## 附录: 完整字段对照表

### 数据库表 → Excel Sheet 映射

| 数据库表 | Excel Sheet | 主键字段 |
|---------|------------|----------|
| hero_attribute_type | 角色数据类型 | attribute_code |
| damage_types | 伤害类型 | code |
| skill_categories | 技能类别 | category_code |
| action_categories | 动作类别 | category_code |
| effect_type_definitions | 元效果类型定义 | effect_type_code |
| formula_variables | 公式变量定义 | variable_code |
| range_config_rules | 射程配置规则 | (无主键) |
| action_type_definitions | 动作类型定义 | action_type |
| skills | 技能配置 | skill_code |
| skill_level_configs | 技能等级配置 | (skill_code + level) |
| actions | 动作配置 | action_code |
| buffs | Buff配置 | buff_code |
| action_flags | 动作标记 | flag_code |
| tags | 特征配置 | tag_code |

---

## 使用此配置表的工作流程

1. **策划阶段**
   - 在Excel中设计和配置所有游戏内容
   - 使用模板快速创建标准配置
   - 利用公式和验证确保数据正确

2. **验证阶段**
   - 运行配置验证工具检查完整性
   - 修复所有报告的错误和警告
   - 生成配置报告给程序审核

3. **导入阶段**
   - 使用导入工具将Excel数据导入数据库
   - 自动处理JSON转换和关联关系
   - 生成导入日志

4. **测试阶段**
   - 在测试环境验证配置效果
   - 根据测试结果调整配置
   - 重新导入更新的配置

5. **发布阶段**
   - 生成配置变更报告
   - 部署到生产环境
   - 更新配置文档

---

## 结语

这个Excel配置表结构完全对应数据库设计，提供了：
- ✅ 完整的字段定义和说明
- ✅ 数据验证和约束规则
- ✅ 配置模板和示例
- ✅ 导入导出流程
- ✅ 最佳实践建议

建议配合开发一个**配置管理工具**，提供：
- 可视化配置界面
- 实时验证和提示
- 配置预览和测试
- 版本管理和对比
- 一键导入导出