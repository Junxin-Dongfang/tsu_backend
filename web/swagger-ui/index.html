<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TSU API æ–‡æ¡£</title>
    <link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist@4.15.5/swagger-ui.css" />
</head>
<body>
    <div id="swagger-ui"></div>
    <script src="https://unpkg.com/swagger-ui-dist@4.15.5/swagger-ui-bundle.js" crossorigin></script>
    <script>
        window.onload = () => {
            // ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„åè®®å’Œä¸»æœº
            const apiDocUrl = window.location.protocol + '//' + window.location.host + '/swagger/admin/doc.json';
            console.log('Loading Swagger from:', apiDocUrl);
            
            window.ui = SwaggerUIBundle({
                url: apiDocUrl,
                dom_id: '#swagger-ui',
                deepLinking: true,
                presets: [
                    SwaggerUIBundle.presets.apis,
                    SwaggerUIBundle.presets.standalone,
                ],
                plugins: [
                    SwaggerUIBundle.plugins.DownloadUrl
                ],
                docExpansion: "list",
                showRequestHeaders: true,
                showCommonExtensions: true,
                persistAuthorization: true,
                // æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨è‡ªåŠ¨å¤„ç† Bearer token
                requestInterceptor: (request) => {
                    console.log('ğŸ” åŸå§‹è¯·æ±‚:', JSON.stringify({
                        url: request.url,
                        method: request.method,
                        headers: request.headers
                    }, null, 2));
                    
                    // æ£€æŸ¥ Authorization header
                    if (request.headers && request.headers.Authorization) {
                        let authValue = request.headers.Authorization;
                        
                        // å¦‚æœç”¨æˆ·è¾“å…¥çš„ token ä¸åŒ…å« "Bearer " å‰ç¼€ï¼Œè‡ªåŠ¨æ·»åŠ 
                        if (!authValue.startsWith('Bearer ') && !authValue.startsWith('bearer ')) {
                            authValue = 'Bearer ' + authValue.trim();
                            request.headers.Authorization = authValue;
                            console.log('âœ… è‡ªåŠ¨æ·»åŠ  Bearer å‰ç¼€');
                        }
                        
                        console.log('ğŸ”‘ Authorization:', authValue);
                    } else {
                        console.warn('âš ï¸  æ²¡æœ‰ Authorization header');
                    }
                    
                    console.log('ğŸ“¤ æœ€ç»ˆè¯·æ±‚å¤´:', JSON.stringify(request.headers, null, 2));
                    return request;
                },
                responseInterceptor: (response) => {
                    console.log('ğŸ“¥ å“åº”çŠ¶æ€:', response.status);
                    console.log('ğŸ“¥ å“åº”å¤´:', JSON.stringify(response.headers, null, 2));
                    return response;
                },
                onComplete: function() {
                    console.log('âœ… Swagger UI åŠ è½½å®Œæˆ');
                    
                    // æ·»åŠ æœåŠ¡å™¨åˆ‡æ¢è¯´æ˜
                    setTimeout(() => {
                        const infoContainer = document.querySelector('.info');
                        if (infoContainer && !document.querySelector('#server-info')) {
                            const serverInfo = document.createElement('div');
                            serverInfo.id = 'server-info';
                            serverInfo.innerHTML = `
                                <div style="margin: 15px 0; padding: 15px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 4px;">
                                    <h4 style="margin: 0 0 10px 0;">ğŸ” è®¤è¯è¯´æ˜</h4>
                                    <ol style="margin: 5px 0; padding-left: 20px;">
                                        <li>ç‚¹å‡»å³ä¸Šè§’ <strong>"Authorize" ğŸ”“</strong> æŒ‰é’®</li>
                                        <li>åœ¨ Value è¾“å…¥æ¡†ä¸­ç²˜è´´ä½ çš„ session tokenï¼ˆä¾‹å¦‚ï¼š<code>ory_st_xxx</code>ï¼‰</li>
                                        <li>ç‚¹å‡» "Authorize" å’Œ "Close"</li>
                                        <li>ç°åœ¨å¯ä»¥æµ‹è¯•éœ€è¦è®¤è¯çš„ API äº†</li>
                                    </ol>
                                    <p style="margin: 10px 0 0 0; font-size: 12px; color: #856404;">
                                        ğŸ’¡ æç¤ºï¼šä¸éœ€è¦æ‰‹åŠ¨è¾“å…¥ "Bearer " å‰ç¼€ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ·»åŠ 
                                    </p>
                                    <p style="margin: 5px 0; font-size: 12px; color: #856404;">
                                        ï¿½ è°ƒè¯•ï¼šæ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰æŸ¥çœ‹è¯·æ±‚è¯¦æƒ…
                                    </p>
                                </div>
                            `;
                            infoContainer.appendChild(serverInfo);
                        }
                    }, 1000);
                }
            });
        };
    </script>
</body>
</html>